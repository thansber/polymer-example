<link rel="import" href="../../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../devices-filter/devices-filter.html">

<dom-module id="devices-menu">
  <template>
    <style>
      :host {
        display: block;
      }

      [menu] {
        border: 1px solid black;
        cursor: pointer;
        display: inline-block;
        margin: 0;
        padding: 1em 2em;
      }

      [menu].iron-selected {
        background-color: black;
        color: white;
      }
    </style>

    <iron-selector attr-for-selected="menu" on-iron-select="_applyFilter">
    <template is="dom-repeat" items="[[ menus ]]" as="menu">
      <div menu$="[[ menu.id ]]">[[ menu.label ]] ([[ menu.count ]])</div>
    </template>
    </iron-selector>

  </template>
  <script>
    Polymer({
      is: 'devices-menu',
      properties: {
        cameras: Array,
        devices: Array,

        filter: {
          notify: true,
          type: String
        },

        lights: Array,
        metadata: {
          type: Object,
          value: function() {
            return {
              cameras: {
                label: 'Cameras'
              },
              lights: {
                label: 'Lights'
              },
              sensors: {
                label: 'Sensors'
              },
              thermostats: {
                label: 'Global Thermonuclear War'
              }
            };
          }
        },
        menus: {
          type: Array,
          value: function() {
            return [];
          }
        },
        sensors: Array,
        thermostats: Array
      },
      observers: [
        '_camerasChanged(cameras)',
        '_lightsChanged(lights)',
        '_sensorsChanged(sensors)',
        '_thermostatsChanged(thermostats)'
      ],

      _camerasChanged: function(cameras) {
        this._menuChanged('cameras', cameras);
      },

      _lightsChanged: function(lights) {
        this._menuChanged('lights', lights);
      },

      _menuChanged: function(type, data) {
        var length = this[type].length;
        var metadata = this.metadata[type];
        this.push('menus', {
          count: length,
          hasContent: !!length,
          id: type,
          label: metadata.label
        });
      },

      _sensorsChanged: function(sensors) {
        this._menuChanged('sensors', sensors);
      },

      _thermostatsChanged: function(thermostats) {
        this._menuChanged('thermostats', thermostats);
      }
    });
  </script>
</dom-module>